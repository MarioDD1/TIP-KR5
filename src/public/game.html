<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ - –ò–≥—Ä–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≤ –ò–≥—Ä–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞</h1>
            <div class="nav">
                <a href="/" class="btn btn-outline">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <button id="resetGame" class="btn btn-outline">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </header>
        
        <main>
            <div class="game-container">
                <div class="game-panel">
                    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h2>
                    <div class="form-group">
                        <label for="playerName">üë§ –í–∞—à–µ –∏–º—è:</label>
                        <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫">
                    </div>
                    <div class="form-group">
                        <label for="minRange">üîΩ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ:</label>
                        <input type="number" id="minRange" value="1" min="1" max="1000">
                    </div>
                    <div class="form-group">
                        <label for="maxRange">üîº –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ:</label>
                        <input type="number" id="maxRange" value="100" min="10" max="1000">
                    </div>
                    <button id="startGame" class="btn btn-primary">
                        üéÆ –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
                    </button>
                    
                    <div class="stats" id="gameStats">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h3>
                        <p>–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</p>
                    </div>
                </div>
                
                <div class="game-panel">
                    <h2>üéØ –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å</h2>
                    
                    <div id="gameStatus" class="game-status">
                        <p>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
                    </div>
                    
                    <div id="guessSection" style="display: none;">
                        <div class="form-group">
                            <label for="guessInput">üéØ –í–∞—à–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                            <input type="number" id="guessInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ">
                        </div>
                        <button id="submitGuess" class="btn btn-success">
                            üì§ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                        </button>
                    </div>
                    
                    <div id="attemptsHistory" class="attempts-history">
                        <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫</h3>
                        <div id="attemptsList"></div>
                    </div>
                </div>
            </div>
        </main>
<!--
        <footer>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –¥–ª—è –∏–≥—Ä—ã: POST /api/game/guess, GET /api/game/state, GET /api/game/stats</p>
        </footer>
    </div>
-->    
    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentGameId = null;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const startGameBtn = document.getElementById('startGame');
        const submitGuessBtn = document.getElementById('submitGuess');
        const guessInput = document.getElementById('guessInput');
        const guessSection = document.getElementById('guessSection');
        const gameStatus = document.getElementById('gameStatus');
        const attemptsList = document.getElementById('attemptsList');
        const resetGameBtn = document.getElementById('resetGame');
        const gameStats = document.getElementById('gameStats');

        // –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
        startGameBtn.addEventListener('click', async () => {
            const playerName = document.getElementById('playerName').value;
            const minRange = parseInt(document.getElementById('minRange').value);
            const maxRange = parseInt(document.getElementById('maxRange').value);
            
            if (minRange >= maxRange) {
                showMessage('–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/game/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        player: playerName,
                        min: minRange,
                        max: maxRange
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentGameId = data.gameId;
                    guessSection.style.display = 'block';
                    showMessage(data.message, 'success');
                    updateGameStats();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        });

        // –°–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ
        submitGuessBtn.addEventListener('click', async () => {
            if (!guessInput.value) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/game/guess', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        guess: guessInput.value
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(data.message, data.status === 'win' ? 'success' : 'info');
                    updateAttemptsHistory(data.game.guesses);
                    guessInput.value = '';
                    
                    if (data.status === 'win' || data.status === 'lose') {
                        guessSection.style.display = 'none';
                    }
                    
                    updateGameStats();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        });

        // –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
        resetGameBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('/api/game/reset', {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentGameId = null;
                    guessSection.style.display = 'none';
                    attemptsList.innerHTML = '';
                    showMessage(data.message, 'success');
                    updateGameStats();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∏–≥—Ä—ã', 'error');
            }
        });

        // –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ø—ã—Ç–æ–∫
        function updateAttemptsHistory(guesses) {
            attemptsList.innerHTML = '';
            
            if (!guesses || guesses.length === 0) {
                attemptsList.innerHTML = '<p>–ü–æ–ø—ã—Ç–æ–∫ –µ—â–µ –Ω–µ –±—ã–ª–æ</p>';
                return;
            }
            
            guesses.forEach(guess => {
                const attemptItem = document.createElement('div');
                attemptItem.className = 'attempt-item';
                
                const guessNumber = document.createElement('span');
                guessNumber.textContent = `–ü–æ–ø—ã—Ç–∫–∞ ${guess.attempt}: ${guess.number}`;
                
                const guessTime = document.createElement('span');
                const time = new Date(guess.timestamp);
                guessTime.textContent = time.toLocaleTimeString();
                
                attemptItem.appendChild(guessNumber);
                attemptItem.appendChild(guessTime);
                attemptsList.prepend(attemptItem);
            });
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä—ã
        async function updateGameStats() {
            try {
                const response = await fetch('/api/game/stats?type=detailed');
                const data = await response.json();
                
                if (response.ok) {
                    let statsHTML = '<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h3>';
                    
                    if (data.active) {
                        statsHTML += `
                            <p><strong>–ò–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞:</strong> –î–∞</p>
                            <p><strong>–ò–≥—Ä–æ–∫:</strong> ${data.lastGame.player}</p>
                            <p><strong>–ü–æ–ø—ã—Ç–æ–∫:</strong> ${data.lastGame.attempts}</p>
                            <p><strong>–í—Ä–µ–º—è –∏–≥—Ä—ã:</strong> ${data.details.timePlaying} —Å–µ–∫</p>
                            <p><strong>–î–∏–∞–ø–∞–∑–æ–Ω:</strong> ${data.details.range}</p>
                        `;
                    } else {
                        statsHTML += `
                            <p><strong>–ò–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞:</strong> –ù–µ—Ç</p>
                            <p>–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</p>
                        `;
                    }
                    
                    gameStats.innerHTML = statsHTML;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(message, type = 'info') {
            let icon = '‚ÑπÔ∏è';
            let color = '#74b9ff';
            
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    color = '#00b894';
                    break;
                case 'error':
                    icon = '‚ùå';
                    color = '#d63031';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    color = '#fdcb6e';
                    break;
            }
            
            gameStatus.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">${icon}</div>
                    <p style="font-size: 1.2rem; color: ${color};">${message}</p>
                </div>
            `;
        }

        // –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
        guessInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitGuessBtn.click();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateGameStats();
    </script>
</body>
</html>